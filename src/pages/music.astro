---
import Layout from "../layouts/Layout.astro";
import { embeds } from "../config/site";

const scUrl = embeds.soundcloudTrackUrl;
const scStart = embeds.soundcloudStartTime;
const spotifyEmbed = embeds.spotifyEmbedSrc;

const scPlayerSrc =
  `https://w.soundcloud.com/player/?url=${encodeURIComponent(scUrl)}&start_time=${scStart}&auto_play=false&visual=true`;

---

<Layout
  title="Music / Sets — BJORNOS"
  description="Luister mijn laatste House mixen en sets."
>
  <section class="section">
    <div class="container-px grid gap-10 md:grid-cols-12">
      <!-- LEFT: SoundCloud -->
      <div class="md:col-span-7" data-reveal>
        <h1 class="text-white">Music / Sets</h1>
        <p class="mt-4 max-w-prose">
          Verse selectie van mixjes en live-opnames. Energie, dynamiek en flow — van EDM tot Hardhouse.
        </p>

        <div
          class="mt-6 overflow-hidden rounded-2xl ring-1 ring-white/10 shadow-lg"
          aria-label="SoundCloud player"
        >
<div class="sc-wrapper">
  <iframe
    id="sc-player"
    width="100%"
    height="360"
    allow="autoplay"
    src={scPlayerSrc}
  ></iframe>
</div>

        </div>
      </div>

      <!-- RIGHT: Spotify -->
      <div class="md:col-span-5" data-reveal data-delay="0.1">
        <div class="surface p-6">
          <h2 class="font-display text-white">Ook op Spotify</h2>
          <p class="mt-2 text-white/80">
            Soms vind je curated playlists op Spotify. Check hieronder:
          </p>

          {spotifyEmbed && (
            <div class="mt-4 overflow-hidden rounded-xl ring-1 ring-white/10">
              <iframe
                src={spotifyEmbed}
                width="100%"
                height="352"
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"
              ></iframe>
            </div>
          )}
        </div>
      </div>
    </div>
  </section>

   <!-- SoundCloud Widget API -->
  <script define:vars={{ scStart }}>
    function initSoundCloudSeek() {
      const iframe = document.getElementById("sc-player");
      if (!iframe) return;

      // Wacht tot SC beschikbaar is
      if (!window.SC || !window.SC.Widget) {
        setTimeout(initSoundCloudSeek, 100);
        return;
      }

      const widget = window.SC.Widget(iframe);

      const forceSeek = () => {
        widget.seekTo(scStart);
        // extra “duwtje” voor de visual player (soms negeert hij de eerste)
        setTimeout(() => widget.seekTo(scStart), 300);
        setTimeout(() => widget.seekTo(scStart), 800);
      };

      widget.bind(window.SC.Widget.Events.READY, () => {
        forceSeek();
      });

      // als READY te vroeg is, spring bij eerste play ook nog
      let hasSeekedOnPlay = false;
      widget.bind(window.SC.Widget.Events.PLAY, () => {
        if (hasSeekedOnPlay) return;
        hasSeekedOnPlay = true;
        forceSeek();
      });
    }

    // beschikbaar maken voor onload
    window.initSoundCloudSeek = initSoundCloudSeek;
  </script>

  <script
    src="https://w.soundcloud.com/player/api.js"
    onload="window.initSoundCloudSeek && window.initSoundCloudSeek()"
  ></script>
</Layout>
